name: CI - FastAPI Productos


on:
push:
branches: [ main, develop ]
pull_request:
branches: [ main, develop ]


jobs:
test:
runs-on: ubuntu-latest


services:
postgres:
image: postgres:15
env:
POSTGRES_USER: products_user
POSTGRES_PASSWORD: products_pass
POSTGRES_DB: products_test_db
ports: ["5432:5432"]
options: >-
--health-cmd pg_isready
--health-interval 10s
--health-timeout 5s
--health-retries 5


env:
DATABASE_URL: postgresql://products_user:products_pass@localhost:5432/products_test_db
JWT_SECRET: super-secret-change-me
JWT_ALGORITHM: HS256
ACCESS_TOKEN_EXPIRE_MINUTES: 1440


steps:
- name: Checkout repo
uses: actions/checkout@v4


- name: Set up Python
uses: actions/setup-python@v5
with:
python-version: '3.11'


- name: Install dependencies
run: |
python -m pip install --upgrade pip
pip install -r requirements.txt


- name: Run tests
run: pytest -v --maxfail=1 --disable-warnings